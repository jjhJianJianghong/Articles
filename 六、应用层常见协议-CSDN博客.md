
![](https://csdnimg.cn/release/blogv2/dist/pc/img/original.png)

[Jianghong Jian](https://blog.csdn.net/2501_93097309 "Jianghong Jian") ![](https://csdnimg.cn/release/blogv2/dist/pc/img/newUpTime2.png) 已于 2025-10-29 23:57:26 修改

版权声明：本文为博主原创文章，遵循 [CC 4.0 BY-SA](http://creativecommons.org/licenses/by-sa/4.0/) 版权协议，转载请附上原文出处链接和本声明。

**应用层协议**

应用层是网络体系结构中的最高层，它为应用程序提供访问网络服务的接口。应用层协议定义了运行在不同端系统上的应用程序进程如何相互传递报文。

**主要应用层协议包括**：DNS、DHCP、FTP、HTTP、TELNET、SMTP/POP3/IMAP、SNMP。

___

#### **6.1 DNS协议**

**互联网的域名结构**

互联网采用层次树状结构的命名方法。任何一个连接到互联网的主机或设备，都有一个唯一的层次结构名称，即域名。

**域名系统概述**

域名系统是互联网的一项核心服务，它作为可以将域名和IP地址相互映射的一个分布式数据库，能够使人更方便地访问互联网，而不用去记住能够被机器直接读取的IP地址。

**域名系统DNS**

DNS是一个分布式、层次化的系统，主要负责将人类可读的域名（如`www.example.com`）转换为机器可读的IP地址（如`192.0.2.1`）。

**域名采用层次树状结构**

域名由一系列用点分隔的标签组成，从右到左层级越来越高。

-   **根域**： 最高级，用点（.）表示，通常省略。
    
-   **顶级域**： 如 `.com`, `.org`, `.net`（通用顶级域），或 `.cn`, `.us`（国家代码顶级域）。
    
-   **二级域**： 用户注册的域名部分，如 `example`。
    
-   **子域**： 二级域下的进一步划分，如 `www`。
    

**域名服务器类型**

DNS系统由多台域名服务器共同协作完成解析，分为四种类型：

1.  **根域名服务器**： 最高层次、最为重要。它知道所有顶级域名服务器的域名和IP地址。全球有13个根服务器逻辑地址。
    
2.  **顶级域名服务器**： 负责管理在该顶级域名服务器下注册的所有二级域名。
    
3.  **权限域名服务器**： 负责一个区的域名解析工作。通常是一个组织或ISP维护的DNS服务器。
    
4.  **本地域名服务器**： 也称为递归域名服务器。它离用户很近，是用户主机进行DNS查询时首先接触的服务器。
    

**提高域名服务器的可靠性**

通过为同一台域名服务器配置**多个IP地址**（负载均衡），以及使用**主从服务器机制**（主服务器数据变化后自动同步到从服务器）来实现高可用性。

**域名的解析过程**

DNS查询分为两种：**递归查询**（客户端要求服务器必须返回最终结果）和**迭代查询**（服务器返回它认为能解答该查询的其他服务器地址）。

**DNS域名一般解析过程**

1.  用户在浏览器输入网址，查询请求发送到**本地域名服务器**。
    
2.  本地域名服务器首先检查自己的缓存，若有记录则直接返回（递归查询）。
    
3.  若没有，本地域名服务器向**根域名服务器**发起迭代查询。
    
4.  根域名服务器返回负责该顶级域（如`.com`）的**顶级域名服务器**地址。
    
5.  本地域名服务器向顶级域名服务器查询。
    
6.  顶级域名服务器返回负责该二级域（如`example.com`）的**权限域名服务器**地址。
    
7.  本地域名服务器向权限域名服务器查询。
    
8.  权限域名服务器返回主机（如`www.example.com`）对应的IP地址。
    
9.  本地域名服务器将IP地址返回给用户主机，并缓存该记录。
    

**DNS常见解析记录**

DNS数据库中存储着各种类型的资源记录。

1.  **A记录**： 将域名指向一个IPv4地址。
    
2.  **CNAME记录**： 别名记录，将一个域名指向另一个域名。
    
3.  **NS记录**： 指定该域名由哪个DNS服务器来进行解析。
    
4.  **AAAA记录**： 将域名指向一个IPv6地址。
    
5.  **MX记录**： 邮件交换记录，指定负责接收该域名邮件的服务器。
    
6.  **PTR记录**： 反向解析记录，用于通过IP地址查询域名。
    
7.  **SRV记录**： 用来标识某台服务器使用了哪个服务，如即时通讯等。
    
8.  **SOA记录**： 起始授权机构记录，包含域名的权威信息，如主域名服务器、管理员邮箱、序列号、刷新间隔等。
    
9.  **TXT记录**： 文本记录，通常用于SPF（反垃圾邮件）、域名所有权验证等。
    

___

#### **6.2 DHCP协议**

**DHCP概念**

动态主机配置协议，用于自动给网络中的客户机分配IP地址、子网掩码、默认网关、DNS服务器等TCP/IP参数，减轻了网络管理员的工作量。

**DHCP工作原理**

客户端通过广播与DHCP服务器交互，过程简称为**DORA**：

-   **Discover**： 客户端广播发送DHCP发现报文，寻找网络中的DHCP服务器。
    
-   **Offer**： DHCP服务器收到发现报文后，从IP地址池中挑选一个IP地址，广播一个提供报文。
    
-   **Request**： 客户端可能收到多个Offer，它选择一个并广播一个请求报文，告知所有DHCP服务器它选择了哪个Offer。
    
-   **Acknowledge**： 被选中的DHCP服务器广播发送确认报文，正式将IP地址租给客户端。
    

**DHCP报文格式**

DHCP报文基于BOOTP协议，使用UDP 67（服务器）和68（客户端）端口。

**DHCP预定义选项字段介绍**

DHCP报文中的`Options`字段用于携带除IP地址外的其他配置参数。

**DHCP消息类型**

通过`Option 53`来标识DHCP报文的类型，如DHCPDISCOVER, DHCPOFFER等。

**Option自定义选项字段介绍**

**Option 82终极代理信息选项**

用于在DHCP Relay（中继）环境中，插入客户端所在物理端口的信息，帮助服务器更精确地分配地址和策略。

**Option 43厂商特定信息选项**

用于DHCP服务器向特定厂商的设备（如AP）传递自定义配置信息。

**DHCP地址续租**

IP地址有租期。租期过半时，客户端会向原服务器发送Request报文请求续租。如果成功，租期重置。如果失败，在租期过87.5%时，客户端会向任何DHCP服务器广播请求。租期到期则释放IP。

**DHCP分配IP地址顺序**

1.  曾经分配过且当前未分配的IP。
    
2.  客户端在Request报文中请求的IP。
    
3.  在地址池中顺序查找下一个可用的IP。
    

**DHCP Relay**

当客户端和服务器不在同一个广播域时，需要网络中的路由器或三层交换机充当DHCP中继代理，将客户端的广播报文转换为单播报文转发给指定的DHCP服务器。

**DHCP Relay配置**

在网络设备（如路由器）的接口上配置`ip helper-address <DHCP服务器IP>`命令。

**DHCP Snooping安全特性**

一种二层安全特性，通过监听DHCP报文，过滤非信任的DHCP报文并构建一个`IP-MAC-端口`的绑定表，用于防止私接DHCP服务器等攻击。

**DHCP Snooping基本配置**

1.  全局开启DHCP Snooping。
    
2.  将连接合法DHCP服务器的端口设置为**信任端口**。
    
3.  连接用户端的端口默认为**非信任端口**，不会接收DHCP Offer等服务器响应报文。
    

___

#### **6.3 FTP协议**

**FTP概述**

文件传输协议，用于在网络上进行文件的双向传输。

**FTP工作原理**

FTP采用**双TCP连接**方式：

-   **控制连接**： 标准端口为21，用于传输FTP命令和响应。在整个会话期间一直保持打开。
    
-   **数据连接**： 用于实际的文件数据传输。传输完成后即断开。
    

**主动模式**

1.  客户端随机开启一个端口N，向服务器的21端口发起控制连接。
    
2.  客户端通过控制连接发送`PORT`命令，告知服务器“我的N+1端口已准备好，请主动连接我”。
    
3.  服务器从20端口**主动**连接到客户端的N+1端口，建立数据连接。
    

**问题**： 客户端的防火墙可能会阻止服务器的主动连接。

**被动模式**

1.  客户端向服务器的21端口发起控制连接。
    
2.  客户端发送`PASV`命令。
    
3.  服务器随机开启一个高端端口P，并告知客户端“我已开启端口P，请你来连接我”。
    
4.  客户端**主动**连接到服务器的端口P，建立数据连接。
    

**优点**： 对客户端防火墙更友好，是现代FTP客户的默认模式。

**FTP抓包分析**

通过Wireshark等工具可以清晰看到控制连接的命令（USER, PASS, LIST, RETR）和响应（331, 230, 150, 226），以及数据连接上的实际数据流。

**FTP客户端常用命令**

-   `open [host]`： 连接FTP服务器。
    
-   `get [remote-file] [local-file]`： 下载文件。
    
-   `put [local-file] [remote-file]`： 上传文件。
    
-   `ls / dir`： 列出目录文件。
    
-   `cd [path]`： 切换远程目录。
    
-   `lcd [path]`： 切换本地目录。
    
-   `binary / ascii`： 设置二进制/文本传输模式。
    
-   `quit / bye`： 退出。
    

___

#### **6.4 HTTP协议**

**URL统一资源定位符**

用于标识互联网上资源的地址。格式为：`协议://主机[:端口]/路径/文件名`。

**使用HTTP的URL**

例如：`http://www.example.com:80/path/to/index.html`，其中端口80通常可省略。

**超文本传送协议HTTP**

一种无状态的应用层协议，用于分布式、协作式和超媒体信息系统的应用。

**HTTP的操作过程**

1.  浏览器分析超链接中的URL。
    
2.  浏览器向DNS请求解析域名的IP地址。
    
3.  DNS返回IP地址。
    
4.  浏览器与服务器建立TCP连接（默认端口80）。
    
5.  浏览器通过TCP连接发出[HTTP请求报文](https://so.csdn.net/so/search?q=HTTP%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87&spm=1001.2101.3001.7020)。
    
6.  服务器返回HTTP响应报文。
    
7.  释放TCP连接。
    
8.  浏览器解析并渲染页面。
    

**请求一个万维网文档所需的时间**

大部分时间消耗在**建立TCP连接**和**等待服务器响应**上。

**协议HTTP/1.0的主要缺点**

每请求一个Web文档（包括HTML主文件和内嵌的图片、CSS、JS等），都需要建立和断开一次TCP连接。这导致效率极低，网络延迟大。

**协议HTTP/1.1使用持续连接**

在一个TCP连接上可以传输多个HTTP请求和响应，减少了建立和关闭连接的消耗。

**持续连接**

**持续连接：非流水线方式**

客户端在收到前一个响应之后，才能发出下一个请求。服务器在发送完一个对象后，TCP连接处于空闲状态，浪费资源。

**持续连接：流水线方式（默认）**

客户端遇到一个引用对象就立即发出一个请求。这样服务器可以持续发送多个对象，效率更高。

**HTTPS**

HTTP over SSL/TLS，即运行在SSL/TLS协议之上的HTTP。它通过加密（防窃听）、认证（防冒充）和完整性保护（防篡改）来确保通信安全。默认端口443。

**HTTP/2**

主要目标是通过**请求/响应多路复用**、**头部压缩**、**服务器推送**等特性来减少延迟。

**HTTP/3**

基于QUIC协议，将传输层从TCP改为UDP，从根本上解决TCP的队头阻塞问题，并集成了TLS 1.3，进一步降低连接建立延迟。

**HTTP/2与HTTP/3对比**

|特性|HTTP/2|HTTP/3|
|---|---|---|
|**传输协议**|TCP|QUIC (基于UDP)|
|**队头阻塞**|应用层解决，但TCP层仍存在|在传输层彻底解决|
|**连接建立**|TCP握手 + TLS握手（2-3 RTT）|首次1 RTT，0-RTT快速重连|
|**前向纠错**|不支持|支持，提高弱网性能|

**代理服务器**

一种网络实体，又称万维网高速缓存。它代表浏览器发出HTTP请求，将最近的一些请求和响应暂存在本地磁盘中。当新请求到达时，若代理服务器中有暂存的副本，就直接返回响应，无需访问源服务器。

**HTTP请求报文的一些方法**

-   **GET**： 请求读取由URL所标识的信息。
    
-   **POST**： 向服务器提交数据（例如提交表单或上传文件）。
    
-   **HEAD**： 请求读取由URL所标识的信息的首部，用于确认URL的有效性及资源更新时间。
    
-   **PUT**： 上传指定的资源表示。
    
-   **DELETE**： 删除指定资源。
    
-   **OPTIONS**： 查询服务器支持的方法。
    

**HTTP状态码**

-   **1xx**： 通知信息，表示请求已接收，继续处理。
    
-   **2xx**： 成功。
    
    -   **200 OK**： 请求成功。
        
    -   **202 Accepted**： 请求已接受，但处理尚未完成。
        
-   **3xx**： 重定向。
    
-   **4xx**： 客户端错误。
    
    -   **400 Bad Request**： 请求报文存在语法错误。
        
    -   **404 Not Found**： 服务器上无法找到请求的资源。
        
-   **5xx**： 服务器错误。
    
    -   **500 Internal Server Error**： 服务器内部错误，无法完成请求。
        

**Cookie和Session**

-   **Cookie**： 一小段文本信息，由服务器生成并发送给浏览器，浏览器会保存它，并在后续的请求中带上它。用于**状态管理**（如用户登录状态）。
    
-   **Session**： 在服务器端保存的用户会话状态。服务器为每个用户创建一个唯一的Session ID，通常通过Cookie传递给客户端。
    

___

#### **6.5 邮件协议**

**邮件协议主要内容**

涉及电子邮件的发送、接收和存储。

**电子邮件系统的组成：三个主要构件**

1.  **用户代理**： 用户与电子邮件系统的接口（如Outlook, Foxmail, 网页邮箱）。
    
2.  **邮件服务器**： 发送和接收邮件，同时向发件人/收件人报告邮件传送结果。
    
3.  **邮件协议**： 邮件发送协议（如SMTP）和邮件读取协议（如POP3, IMAP）。
    

**发送和接受电子邮件的过程（“推” “拉”）**

1.  **发件人**用UA撰写邮件，通过SMTP协议**“推”** 到发送方邮件服务器。
    
2.  发送方邮件服务器将邮件放入发送队列，通过SMTP协议**“推”** 到接收方邮件服务器。
    
3.  收件人通过UA，使用POP3或IMAP协议从接收方邮件服务器**“拉”** 取邮件到本地。
    

**电子邮件地址的格式**

`用户名@邮箱所在主机的域名`，例如`user@example.com`。

**POP3和IMAP的区别**

1.  **POP3（110端口）**
    
    -   **工作方式**： 从服务器下载邮件到本地客户端，通常会删除服务器上的邮件（可配置为保留）。
        
    -   **特点**： 简单，离线操作。但无法在多设备间同步邮件状态（已读/未读、文件夹管理等）。
        
2.  **IMAP（143端口）**
    
    -   **工作方式**： 在服务器上管理邮件，客户端操作（移动邮件、标记已读）会同步到服务器。
        
    -   **特点**： 更强大，支持在线和离线操作，完美支持多设备访问，邮件始终保持在服务器上。
        

**通用互联网邮件扩充MIME**

由于SMTP只能传输7位ASCII码文本，MIME扩展了电子邮件格式，使其可以支持非文本附件、多部分消息体、非ASCII字符集等。

**常用的MIME编码方法**

-   **Base64**： 将二进制数据编码成ASCII字符，用于传输图片、音频等。
    
-   **Quoted-printable**： 用于将8位字节编码成可打印的ASCII字符，适合对文本内容进行编码。
    

**电子邮件安全协议**

-   **PGP**： 一个基于RSA公钥加密体系的邮件加密软件，提供数字签名和加密服务。
    
-   **S/MIME**： 一个工业标准，用于发送和接收安全MIME数据，提供认证、报文明性、非否认和隐私保护。
    

___

#### **6.6 TELNET协议**

**通过TCP连接**

TELNET使用TCP端口23进行通信。

**远程终端协议TELNET**

允许用户在一台主机上通过终端仿真登录到另一台远程主机，并对其进行操作，就像直接坐在那台主机前一样。

**Telnet的安全性**

**致命缺点**： TELNET以**明文**方式传输所有数据（包括用户名和密码），极易被窃听，因此**极其不安全**。

**SSH+Telnet=Stelnet**

Stelnet是一种安全的Telnet服务，它利用SSH协议来加密TELNET会话，提供安全的远程登录功能。

**SSH+FTP=SFTP**

SSH文件传输协议，是SSH的一部分，提供安全的文件传输服务，替代不安全的FTP。

**补充说明**： Telnet采用客户端/服务器等工作方式，采用NVT（网络虚拟终端）格式实现数据传输，以屏蔽不同操作系统终端差异。

___

#### **6.7 SNMP协议**

**通过UDP连接**

SNMP使用UDP协议，**SNMP Agent**（代理）监听**161端口**，**SNMP Manager**（管理器）接收**Trap**（陷阱）消息的**162端口**。

**网络管理的五大功能**

故障管理、配置管理、计费管理、性能管理和安全管理。

**简单网络管理协议SNMP**

用于网络管理站与被管设备（如路由器、交换机）上的代理进程之间交换管理信息。

**SNMP版本**

-   **SNMPv1/v2c**： 基于**团体名**进行安全认证，类似密码，但以明文传输，安全性弱。
    
-   **SNMPv3**： 提供了基于用户的安全模型，支持加密和认证，安全性强。
    

**SNMP管理模型**

包含三个核心组件：

1.  **NMS**： 网络管理系统，即管理器。
    
2.  **Agent**： 代理进程，运行在被管设备上。
    
3.  **MIB**： 管理信息库，被管设备上所有可被管理对象的集合。
    

**MIB**

一个分层组织的数据库，它定义了被管设备上可供查询和设置的管理对象。每个对象都有一个唯一的OID（对象标识符）来标识。

**常见MIB节点**

-   `1.3.6.1.2.1.1.1`： `sysDescr`，系统描述。
    
-   `1.3.6.1.2.1.1.3`： `sysUpTime`，系统运行时间。
    
-   `1.3.6.1.2.1.2.2.1.10`： `ifInOctets`，接口输入流量。
    

**SNMPv3**

**SNMPv3基本操作**

支持`Get`, `GetNext`, `Set`, `Trap/Inform`等操作，但增加了安全处理。

**SNMPv3配置举例**

在设备上需要创建SNMPv3用户，并指定认证和加密算法及密码。

```cobol
snmp-agent group v3 mygroup privacysnmp-agent usm-user v3 myuser mygroup authentication-mode sha cipher Hello123! privacy-mode aes128 cipher Hello123!
```

**SNMPv3安全性**

通过USM（基于用户的安全模型）提供：

-   **认证**： 验证消息来源的合法性，防冒充。
    
-   **加密**： 对报文载荷加密，防窃听。
    

**SNMPv3安全性增强**

相比v1/v2c，v3提供了完整的安全体系，是当前推荐使用的版本。

**SNMP交互**

-   **SNMP交互-Get**： 管理器请求获取一个或多个MIB对象的值。
    
-   **SNMP交互-GetNext**： 管理器请求获取MIB树中下一个对象的值，用于遍历。
    
-   **SNMP交互-Get Bulk**： （v2c/v3）一次批量获取大量数据，效率高于多次GetNext。
    
-   **SNMP交互-Set**： 管理器对设备上的MIB对象进行配置。
    
-   **SNMP交互-Trap**： 被管设备**主动**向管理器发送异步通知，报告异常事件。**无确认**。
    
-   **SNMP交互-Inform**： 被管设备**主动**向管理器发送异步通知。管理器需要**回送确认**，更可靠。
    

**SNMP报文格式**

由**版本号**、**团体名/安全参数**和**协议数据单元**组成。

**SNMPv1、SNMPv2、SNMPv3对比**

|特性|SNMPv1|SNMPv2c|SNMPv3|
|---|---|---|---|
|**安全性**|团体名（明文）|团体名（明文）|基于用户（认证+加密）|
|**性能**|基础|新增GetBulk，提升效率|同v2c，但增加安全开销|
|**推荐度**|已淘汰|内网使用|**生产环境推荐**|