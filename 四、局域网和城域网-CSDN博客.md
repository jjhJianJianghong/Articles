
![](https://csdnimg.cn/release/blogv2/dist/pc/img/original.png)

[Jianghong Jian](https://blog.csdn.net/2501_93097309 "Jianghong Jian") ![](https://csdnimg.cn/release/blogv2/dist/pc/img/newUpTime2.png) 已于 2025-09-06 16:36:06 修改

版权声明：本文为博主原创文章，遵循 [CC 4.0 BY-SA](http://creativecommons.org/licenses/by-sa/4.0/) 版权协议，转载请附上原文出处链接和本声明。

## 1\. 局域网基础

### 定义

在有限地理范围内（如学校、办公楼），将各种[计算机](https://so.csdn.net/so/search?q=%E8%AE%A1%E7%AE%97%E6%9C%BA&spm=1001.2101.3001.7020)、外部设备和数据库系统通过传输介质互连起来，组成的数据通信网络。

### 关键技术要素

#### 拓扑结构

总线型、星型、环型。

#### [传输介质](https://so.csdn.net/so/search?q=%E4%BC%A0%E8%BE%93%E4%BB%8B%E8%B4%A8&spm=1001.2101.3001.7020)

双绞线（UTP）、同轴电缆（已淘汰）、光纤。

#### 介质访问控制（MAC）方法

核心是如何协调多个设备共享同一物理信道。主要方法包括：

    1. 争用型：如CSMA/CD，用于传统以太网。

    2. 确定性型：如令牌环（Token Ring），已淘汰。

## 2\. CSMA/CD（载波监听多点接入/碰撞检测）

### 原理

先听后发，边发边听，冲突停发，延迟重发。

  1. 载波监听（先听后发）：站点在发送前先侦听信道是否空闲。

  2. 多点接入：多个站点连接在同一总线上。

  3. 碰撞检测（边发边听）：发送过程中持续检测信道，判断是否发生冲突（信号电压异常升高）。

  4. 冲突处理：一旦检测到冲突，立即停止发送，并发送一个强化冲突信号（Jamming Signal），然后等待一段随机时间后重试。

### 三种监听算法

（解决“如果信道忙，该怎么办”的问题）

###   1-坚持型CSMA

    · 原理：侦听到信道忙时，持续侦听，一旦空闲就立即以概率1发送。

    · 优点：避免信道浪费。

    · 缺点：如果有两个或多个站点在等待，一旦空闲必然发生冲突。

###   非坚持型CSMA

    · 原理：侦听到信道忙时，放弃侦听，等待一个随机时间后再重新侦听。

    · 优点：减少了冲突的概率。

    · 缺点：可能会增加信道空闲时间，降低效率。

###   P-坚持型CSMA（适用于时隙信道）

    · 原理：侦听到信道空闲时，以概率P发送数据，以概率(1-P)延迟一个时间单位后重新侦听。

    · 目的：是一种既能像非坚持算法那样减少冲突，又能像1-坚持算法那样减少媒体空闲时间的折中方案。

## 3\. 二进制指数退避算法

### 原理

发生冲突后，站点延迟重发的时间不是固定的，而是根据冲突次数动态计算的随机值。

  · 基本退避时间 = $2τ$（争用期/冲突窗口，$τ$ 为端到端传播时延）。

  · 从整数集合 $\[0, 1, ..., 2^k - 1\]$ 中随机取一个数 $r$，重传所需的延迟时间就是 $r$ 倍的基本退避时间。

  · $k = min(冲突次数, 10)$。即 $k$ 最大为10，集合最大为 $\[0, 1, ..., 1023\]$。

### 注意

  · 冲突次数越多，$k$ 越大，随机范围越大，平均等待时间越长。这是一种动态均衡负载的机制。

  · 当冲突超过 16次 后，尝试失败，丢弃该帧，向高层报告错误。

## 4\. 最小帧长计算

### 公式

$最小帧长(L\_{min}) = 数据传输速率(R) × 往返时延(2τ)$

  · $2τ$ 即争用期，是帧开始发出后到能检测到冲突的最长时间。

### 不冲突条件

帧的发送时间 ($T\_t = 帧长 / 速率$) 必须大于等于 往返传播时延 ($2τ$)。

### 目的

确保站点在帧发送结束前能检测到所有可能的冲突。

### 经典应用

  · 10Mbps以太网，$2τ$ 规定为 51.2μs。

  · $L\_{min} = 10Mbps × 51.2μs = 512bit = 64字节$。

  · 这就是以太网帧最小64字节（含帧头帧尾）的由来。短于64字节的帧被视为冲突碎片而被丢弃。

## 5\. 以太网帧结构和物理层规范

以太网帧结构 (Ethernet II / DIX V2.0)

![](%E5%9B%9B%E5%B1%80%E5%9F%9F%E7%BD%91%E5%92%8C%E5%9F%8E%E5%9F%9F%E7%BD%91/a259ee16cf7e411abe5c257db1ce85dd.jpg)

### 类型字段

标识上层协议（如0x0800为IP，0x0806为ARP）。

### 数据字段

MTU（最大传输单元）为1500字节。

## 千兆以太网

虽然标准保留CSMA/CD，但由于全双工模式的普及和交换机的广泛应用，实际中CSMA/CD已基本不再使用。在半双工模式下，为保持64字节最小帧长，采用了载波扩展技术。

![](%E5%9B%9B%E5%B1%80%E5%9F%9F%E7%BD%91%E5%92%8C%E5%9F%8E%E5%9F%9F%E7%BD%91/091d369a66f34535ad89f98a05b96f39.jpg)

##  万兆以太网

只工作在全双工模式，彻底淘汰了CSMA/CD。其物理层仅使用光纤，不再支持双绞线，且只能用于LAN/MAN，不能用于广域网（后续标准有扩展）。

![](%E5%9B%9B%E5%B1%80%E5%9F%9F%E7%BD%91%E5%92%8C%E5%9F%8E%E5%9F%9F%E7%BD%91/c9f37a78a7324558804e9243600528c7.jpg)

## 6\. 虚拟局域网 (VLAN)

### VLAN基础

一种将物理上的局域网在逻辑上划分成多个广播域的技术。同一VLAN内的主机可以像在一个真实的局域网中一样通信，而不同VLAN间则相互隔离，通信需要三层设备（路由器或三层交换机）。

### 冲突域 vs 广播域

####   冲突域

一个站点发送数据会与其他站点发送数据产生冲突的范围。交换机每个端口是一个冲突域。

####   广播域

广播帧所能传播到的范围。一个VLAN就是一个广播域。路由器可以隔离广播域。

### 交换机VLAN划分方法

#### 静态划分（基于端口）

最常用。将交换机的端口直接分配给某个VLAN。

#### 动态划分

    基于MAC地址：

根据主机的MAC地址将其动态划分到指定的VLAN。需要配置MAC地址与VLAN的映射数据库。

    基于策略：

根据IP子网、协议类型等策略规则自动划分VLAN。

### VLAN的作用

  1. 控制广播：限制广播帧只在必要的VLAN内传播，节省带宽，提高性能。

  2. 增强安全：隔离不同部门或组（如财务部和市场部），逻辑隔离。

  3. 提高灵活性：组建逻辑工作组不受物理位置限制。

### IEEE 802.1Q标签（Trunking）

  · 用于在交换机和路由器之间承载多个VLAN流量的协议。

  · 它在标准以太网帧的源MAC地址和类型字段之间插入了4字节的VLAN Tag。

### VLAN Tag 包含的内容

    · TPID：标记协议标识符，固定为0x8100，表明这是一个802.1Q帧。

    · PRI：3位优先级字段，用于QoS。

    · CFI：1位标准格式指示器。

    · VID：12位的VLAN ID，标识该帧属于哪个VLAN（范围1-4094）。

### 交换机端口类型

#### Access口

通常用于连接计算机或服务器。该端口仅属于一个VLAN。发送的帧是无标签的标准以太网帧。

### Trunk口

用于交换机之间或交换机与路由器之间的连接。该端口允许多个VLAN的流量通过。发送的帧是带802.1Q标签的帧（Native VLAN除外）。

####  Hybrid口（华为设备常见）

是Access和Trunk的混合模式，可以自由配置端口在发送某个VLAN的帧时是否带标签。

## 7\. 生成树协议 (STP)

### 二层环路问题

#### 广播风暴

交换机对广播帧、组播帧和未知目的单播帧进行泛洪。存在物理环路时，这些帧会在环路中无限循环，耗尽所有带宽和交换机资源。

#### MAC表震荡

同一数据帧通过不同端口到达交换机，导致交换机的MAC地址表项在端口间反复更新，无法稳定学习。

### STP基本概念

通过在逻辑上阻塞特定端口来打破环路，形成一棵无环的“树”。当活动路径发生故障时，STP会重新计算并激活备用路径，恢复网络连通性。

### 关键概念

#### 网桥ID (BID)

由网桥优先级（2字节） 和 MAC地址（6字节） 组成。值越小越优先。

#### 路径开销

根据链路带宽计算，带宽越大，开销越小。用于选择最佳路径。

### STP选举操作（802.1D）

  1. 选举根桥：整个网络中BID最小的交换机成为根桥。

  2. 选举根端口：每台非根桥交换机上，到达根桥路径开销最小的端口成为根端口。

  3. 选举指定端口：每个物理网段（链路） 上，到达根桥路径开销最小的交换机端口成为该网段的指定端口。

  4. 阻塞其它端口：既不是根端口也不是指定端口的端口将被置为阻塞状态，从而打破环路。

### 几种生成树协议

  · STP (802.1D)：原始版本，收敛速度慢（30-50秒）。

  · RSTP (802.1w)：快速生成树，是STP的改进版，引入了新的端口角色和状态，收敛速度极快（1秒以内）。现已成事实标准，基本取代STP。

  · MSTP (802.1s)：多实例生成树，允许将多个VLAN映射到一个生成树实例上，实现负载均衡（不同VLAN的流量走不同的Trunk链路）。

## 8\. 城域网 (MAN)

## 定义

作用范围介于LAN和WAN之间，覆盖一个城市范围的网络。

### E-LAN（以太网局域网业务）

一种运营商提供的多点对多点的二层VPN业务。它通过城域网网络模拟了一个大型的二层以太网交换机，使得连接在不同用户站点的设备感觉像是在同一个局域网中。

### IEEE 802.1ah (MAC-in-MAC / PBB)

  · 提供商骨干网桥接，一种运营商级的城域网以太网技术。

  · 核心思想：将用户的以太网帧（C-MAC）整个作为载荷，再封装上运营商自己的帧头（B-MAC和B-VID）。

### 优点

    1. 良好的扩展性：运营商网络和用户网络使用独立的MAC地址空间。

    2. 增强的安全性：彻底隔离了用户网络和运营商网络，用户MAC地址对核心网不可见。

    3. 强大的QoS支持：为大规模部署以太网服务提供了基础。